<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è…¦ç­‹æ€¥è½‰å½ - è‡ªè¨‚èªéŸ³ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; touch-action: manipulation; overflow: hidden; }
        .feedback-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 15rem; opacity: 0; pointer-events: none; z-index: 50; }
        .show-feedback { animation: popFeedback 0.8s ease-out forwards; }
        @keyframes popFeedback {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
        .firework-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 40; display: none; background: rgba(0,0,0,0.1); }
        .toggle-checkbox:checked + .toggle-label { background-color: #3b82f6; }
        .toggle-checkbox:checked + .toggle-label > .toggle-circle { transform: translateX(100%); }
        .toggle-label { width: 40px; height: 20px; }
        .toggle-circle { top: 2px; left: 2px; width: 16px; height: 16px; }
        input[type="range"] { accent-color: #3b82f6; }
    </style>
</head>
<body class="h-screen flex items-center justify-center p-4">

    <div id="firework-canvas" class="firework-overlay"></div>

    <div class="w-full max-w-md bg-white rounded-[2.5rem] shadow-2xl overflow-hidden min-h-[660px] flex flex-col relative border border-slate-200 z-10">
        
        <!-- ç­”é¡Œåé¥‹ -->
        <div id="correct-mark" class="feedback-icon text-green-500">â­•</div>
        <div id="wrong-mark" class="feedback-icon text-red-500">âŒ</div>

        <div class="w-full h-2 bg-slate-100">
            <div id="progress-bar" class="h-full bg-blue-500 transition-all duration-500 w-0"></div>
        </div>

        <!-- é–‹å§‹ç•«é¢ -->
        <div id="start-screen" class="flex-1 flex flex-col items-center justify-center p-8 text-center space-y-6">
            <div class="text-7xl animate-bounce">ğŸ™ï¸</div>
            <div>
                <h1 class="text-3xl font-black text-slate-800">è…¦ç­‹æ€¥è½‰å½</h1>
                <p class="text-slate-500 font-bold">100é¡Œåº« Â· èªéŸ³å®¢è£½ç‰ˆ</p>
            </div>
            
            <!-- èªéŸ³è¨­å®šå€ -->
            <div class="w-full bg-slate-50 rounded-2xl p-4 space-y-3 border border-slate-100 text-left">
                <p class="text-xs font-black text-slate-400 uppercase tracking-widest"><i class="fas fa-cog mr-1"></i> èªéŸ³åå¥½è¨­å®š</p>
                
                <div>
                    <label class="text-xs font-bold text-slate-600 block mb-1">é¸æ“‡è²éŸ³</label>
                    <select id="voice-select" class="w-full text-sm p-2 rounded-lg border border-slate-200 bg-white focus:ring-2 focus:ring-blue-500 outline-none"></select>
                </div>

                <div class="flex space-x-4">
                    <div class="flex-1">
                        <label class="text-xs font-bold text-slate-600 block mb-1">éŸ³èª¿ (Pitch)</label>
                        <input type="range" id="pitch-range" min="0.5" max="2" step="0.1" value="1" class="w-full">
                    </div>
                    <div class="flex-1">
                        <label class="text-xs font-bold text-slate-600 block mb-1">èªé€Ÿ (Rate)</label>
                        <input type="range" id="rate-range" min="0.5" max="1.5" step="0.1" value="1.1" class="w-full">
                    </div>
                </div>
            </div>

            <button onclick="startGame()" class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-2xl text-xl font-black shadow-xl transition-all active:scale-95">
                é–‹å§‹æŒ‘æˆ°
            </button>
        </div>

        <!-- éŠæˆ²ä¸»ç•«é¢ -->
        <div id="game-screen" class="hidden flex-1 flex flex-col p-6 relative">
            <!-- é ‚éƒ¨è³‡è¨Šèˆ‡å¿«é€Ÿåˆ‡æ› -->
            <div class="flex justify-between items-start mb-4">
                <div class="space-y-1">
                    <span id="question-counter" class="text-xs font-black text-blue-600 bg-blue-50 px-3 py-1 rounded-lg">Question 1/10</span>
                    <div class="text-xl font-black text-slate-700">å¾—åˆ†: <span id="score-display" class="text-blue-600">0</span></div>
                </div>
                <div class="bg-slate-50 p-2 rounded-xl border border-slate-100 space-y-1 shadow-sm text-[9px] font-black text-slate-400">
                    <div class="flex items-center justify-between min-w-[70px]">
                        <span>è®€é¡Œ</span>
                        <input type="checkbox" id="toggle-q" class="toggle-checkbox hidden" checked>
                        <label for="toggle-q" class="toggle-label block overflow-hidden h-4 rounded-full bg-slate-300 cursor-pointer relative transition-colors">
                            <span class="toggle-circle absolute block bg-white rounded-full shadow transition-transform" style="width:12px; height:12px;"></span>
                        </label>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>è®€é …</span>
                        <input type="checkbox" id="toggle-a" class="toggle-checkbox hidden" checked>
                        <label for="toggle-a" class="toggle-label block overflow-hidden h-4 rounded-full bg-slate-300 cursor-pointer relative transition-colors">
                            <span class="toggle-circle absolute block bg-white rounded-full shadow transition-transform" style="width:12px; height:12px;"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="flex-1 flex flex-col items-center justify-center mb-6">
                <button onclick="replayCurrentSequence()" class="mb-4 w-14 h-14 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center shadow-inner hover:bg-blue-200 transition-colors">
                    <i class="fas fa-volume-high text-xl"></i>
                </button>
                <h2 id="question-text" class="text-2xl font-black text-slate-800 text-center leading-snug px-4">è¼‰å…¥ä¸­...</h2>
            </div>

            <div id="options-container" class="grid grid-cols-1 gap-3 mb-2"></div>
        </div>

        <!-- çµç®—ç•«é¢ -->
        <div id="result-screen" class="hidden flex-1 flex flex-col items-center justify-center p-8 text-center space-y-6">
            <div id="result-emoji" class="text-8xl mb-2">ğŸ…</div>
            <h2 class="text-3xl font-black text-slate-800">è¼ªæ¬¡çµæŸ</h2>
            <div class="bg-blue-50 rounded-3xl p-6 w-full border border-blue-100">
                <p id="final-score" class="text-7xl font-black text-blue-600">0</p>
                <p class="text-blue-400 font-black mt-1 tracking-widest">TOTAL SCORE</p>
            </div>
            <div class="space-y-1">
                <p id="result-comment" class="text-xl font-black text-slate-700"></p>
                <p id="remaining-info" class="text-sm font-bold text-slate-400"></p>
            </div>
            <button onclick="location.reload()" class="w-full py-4 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-2xl text-lg font-bold transition-all mb-2">
                è¿”å›è¨­å®šè²éŸ³
            </button>
            <button id="next-btn" onclick="restartGame()" class="w-full py-4 bg-slate-800 hover:bg-slate-900 text-white rounded-2xl text-xl font-bold shadow-lg transition-transform active:scale-95">
                ç›´æ¥æŒ‘æˆ°ä¸‹ä¸€è¼ª
            </button>
        </div>
    </div>

    <script>
        // é¡Œç›®åº« (ç•¥ç¸®ï¼Œä¿ç•™100é¡Œé‚è¼¯)
        const fullLibrary = [
            { q: "å¹´å¹´æœ‰é¤˜ï¼Œç‚ºä»€éº¼é‚„æ˜¯å­˜ä¸åˆ°éŒ¢ï¼Ÿ", a: "å› ç‚ºå¹´å¹´éƒ½è¢«ç‚’é­·é­š", wrong: ["å› ç‚ºéŒ¢éƒ½æ‹¿å»è²·é­šäº†", "å› ç‚ºç‰©åƒ¹æ¼²å¤ªå¿«"] },
            { q: "ç‚ºä»€éº¼é‚Šç·£äººä¸å‰ªé ­é«®ï¼Ÿ", a: "å› ç‚ºæ²’äººè¦ç†ä»–", wrong: ["å› ç‚ºå‰ªé ­é«®å¾ˆè²´", "å› ç‚ºæƒ³è®Šé•·é«®å…¬ä¸»"] },
            { q: "ç¸½çµ±åºœå‰é¢é‚£æ¢è·¯æ˜¯ä»€éº¼è·¯ï¼Ÿ", a: "æŸæ²¹è·¯", wrong: ["å‡±é”æ ¼è˜­å¤§é“", "é‡æ…¶å—è·¯"] },
            { q: "éº’éºŸé£›åˆ°åŒ—æ¥µæœƒè®Šæˆä»€éº¼ï¼Ÿ", a: "å†°æ·‡æ·‹", wrong: ["å†·å‡éº’éºŸ", "åŒ—æ¥µéº’éºŸ"] },
            { q: "å“ªç¨®é£Ÿç‰©æœ€èª å¯¦ï¼Ÿ", a: "æŠ«è–©", wrong: ["èª å¯¦è±†æ²™åŒ…", "è€å¯¦é›"] },
            { q: "å“ªå…©å€‹è‹±æ–‡å­—æ¯æ”¾åœ¨ä¸€èµ·æœƒçˆ†ç‚¸ï¼Ÿ", a: "OKç¹ƒ", wrong: ["TNT", "ABè† "] },
            { q: "æ­·å²ä¸Šå“ªå€‹äººç‰©è·‘æœ€å¿«ï¼Ÿ", a: "æ›¹æ“", wrong: ["åŠ‰ç¿”", "é–ƒé›»ä¿ "] },
            { q: "ä»€éº¼æ±è¥¿é çœ‹åƒæ°´æ¡¶ï¼Œè¿‘çœ‹å»ç ´ä¸€å€‹æ´ï¼Ÿ", a: "ç ´æ°´æ¡¶", wrong: ["ç”œç”œåœˆ", "æ•‘ç”Ÿåœˆ"] },
            { q: "ç‚ºä»€éº¼æš–æš–åŒ…æœ‰ä¸€å †äººåœ¨ç”¨ï¼Ÿ", a: "å› ç‚ºå®ƒæœ‰éµç²‰", wrong: ["å› ç‚ºå¤©æ°£å†·", "å› ç‚ºä¾¿å®œ"] },
            { q: "è€¶ç©Œæ˜¯å“ªä¸€åœ‹äººï¼Ÿ", a: "å¤©åœ‹", wrong: ["ä»¥è‰²åˆ—äºº", "ç¾åœ‹äºº"] },
            { q: "å“ªç¨®èŠ±å¤å¤©æ˜¯å†°å†·çš„ï¼Œå†¬å¤©æ˜¯æº«ç†±çš„ï¼Ÿ", a: "è±†èŠ±", wrong: ["å†°èŠ±", "é›ªèŠ±"] },
            { q: "çš®å¡ä¸˜ç«™èµ·ä¾†æœƒè®Šæˆä»€éº¼ï¼Ÿ", a: "çš®å¡å…µ", wrong: ["é›·ä¸˜", "çš®å¡ä¸˜ç«™é•·"] },
            { q: "ä»€éº¼æƒ…æ³ä¸‹äººæœƒæœ‰å››éš»çœ¼ç›ï¼Ÿ", a: "å…©å€‹äººçš„æ™‚å€™", wrong: ["æˆ´çœ¼é¡æ™‚", "çœ‹3Dé›»å½±"] },
            { q: "ç‚ºä»€éº¼ç¾äººé­šæœ€å°ˆæƒ…ï¼Ÿ", a: "å› ç‚ºå¥¹ä¸æœƒåŠˆè…¿", wrong: ["å› ç‚ºå¥¹æ„›ç‹å­", "å› ç‚ºæµ·å¾ˆå¤§"] },
            { q: "èª°æ˜¯æœ€å¤±æ•—çš„äººï¼Ÿ", a: "èœ˜è››äºº", wrong: ["è€ƒé›¶åˆ†çš„äºº", "ç ´ç”¢çš„äºº"] },
            { q: "æœ‰ä¸€éš»é›ç‚ºä»€éº¼å¾ˆå–œæ­¡å¹é¢¨ï¼Ÿ", a: "å› ç‚ºå®ƒæ˜¯å¹é¢¨æ©Ÿ", wrong: ["å› ç‚ºç†±", "å› ç‚ºæƒ³é£›"] },
            { q: "ç‚ºä»€éº¼è ¶å¯¶å¯¶å¾ˆæœ‰éŒ¢ï¼Ÿ", a: "å› ç‚ºå®ƒæœƒçµç¹­", wrong: ["å®ƒåƒæ¡‘è‘‰", "å®ƒæœ‰çµ²ç¶¢"] },
            { q: "ç‚ºä»€éº¼è­¦å¯Ÿéƒ½ä¸æ˜¯å·é«®ï¼Ÿ", a: "å› ç‚ºæ˜¯åŸ·æ³•äººå“¡", wrong: ["è¦å®šä¸èƒ½ç‡™", "å¤©ç”Ÿçš„"] },
            { q: "æ‰“é›»è©±çµ¦çƒé¾œï¼ŒçŒœä¸€ç¨®è”¬èœï¼Ÿ", a: "è‹¦ç“œ", wrong: ["åœ°ç“œ", "çµ²ç“œ"] },
            { q: "ç¶ è±†å“ªè£¡äººï¼Ÿ", a: "å˜‰ç¾©äºº", wrong: ["å°æ±äºº", "ç¶ å³¶äºº"] },
            { q: "å£äº‹ä¸€å®šè¦åœ¨ä¸­åˆåšï¼Œç‚ºä»€éº¼ï¼Ÿ", a: "å› ç‚ºæ—©æ™šæœƒæœ‰å ±æ‡‰", wrong: ["å¤ªé™½æ¯”è¼ƒå¤§", "æ²’äººçœ‹è¦‹"] },
            { q: "ä»€éº¼æ±è¥¿æœƒè¶Šæ“¦è¶Šé»‘ï¼Ÿ", a: "é»‘æ¿", wrong: ["æŠ¹å¸ƒ", "çš®é‹"] },
            { q: "æ¯å€‹äººç¡å‰ä¸€å®šä¸æœƒå¿˜è¨˜åšä»€éº¼ï¼Ÿ", a: "é–‰ä¸Šçœ¼ç›", wrong: ["åˆ·ç‰™", "è¨­é¬§é˜"] },
            { q: "å°ç£å“ªå€‹æ¹–æœ€å¤§ï¼Ÿ", a: "æ¾æ¹–", wrong: ["æ—¥æœˆæ½­", "æ¾„æ¸…æ¹–"] },
            { q: "èŠ¥æœ«ç”Ÿæ—¥å“ªä¸€å¤©ï¼Ÿ", a: "ä¸–ç•Œæœ«æ—¥", wrong: ["10æœˆ10æ—¥", "5æœˆ5æ—¥"] },
            { q: "åœ°éœ‡æ™‚å“ªè£¡æœ€å®‰å…¨ï¼Ÿ", a: "é£›æ©Ÿä¸Š", wrong: ["æ¡Œå­ä¸‹", "å…¬åœ’è£¡"] },
            { q: "ç‚ºä»€éº¼ç…™ç«ä¸æœƒæ‰“åˆ°æ˜Ÿæ˜Ÿï¼Ÿ", a: "å› ç‚ºæ˜Ÿæ˜Ÿæœƒé–ƒ", wrong: ["æ˜Ÿæ˜Ÿå¤ªé«˜", "ç…™ç«ä¸å¤ åŠ›"] },
            { q: "æ±½è»Šè½‰å½æ™‚å“ªå€‹è¼ªèƒä¸æœƒå‹•ï¼Ÿ", a: "å‚™èƒ", wrong: ["å·¦å‰è¼ª", "å¾Œè¼ª"] },
            { q: "å¤§æ¨¹è·Ÿå°æ¨¹å·®åœ¨å“ªè£¡ï¼Ÿ", a: "æ’åœ¨åœŸè£¡", wrong: ["èº«é«˜", "å¹´é½¡"] },
            { q: "é³³æ¢¨å’Œè¥¿ç“œæ‰“é ­ï¼Œå“ªå€‹æ¯”è¼ƒç—›ï¼Ÿ", a: "é ­æ¯”è¼ƒç—›", wrong: ["é³³æ¢¨", "è¥¿ç“œ"] },
            { q: "ç¬¬åä¸€æœ¬æ›¸æ˜¯ä»€éº¼æ›¸ï¼Ÿ", a: "ä¸å¯æ€è­°", wrong: ["è¾­å…¸", "ç™¾ç§‘å…¨æ›¸"] },
            { q: "å…©ç¢—æ³¡éºµéƒ½è¢«å·äº†ï¼ŒçŒœæˆèªï¼Ÿ", a: "é¢é¢ä¿±åˆ°", wrong: ["é£¢è…¸è½†è½†", "ä¸€ç„¡æ‰€æœ‰"] },
            { q: "å°å­©å­è·Œå€’ï¼ŒçŒœæˆèªï¼Ÿ", a: "é¦¬é¦¬è™è™", wrong: ["å››è…³æœå¤©", "æ¬²å“­ç„¡æ·š"] },
            { q: "ä»€éº¼æ›¸æ›¸åº—è²·ä¸åˆ°ï¼Ÿ", a: "ç§˜æ›¸", wrong: ["ç¦æ›¸", "é›»å­æ›¸"] },
            { q: "ä»€éº¼æ°´æ”¾å£è¢‹ä¸æœƒæ¿•ï¼Ÿ", a: "è–ªæ°´", wrong: ["æ±—æ°´", "å£æ°´"] },
            { q: "ç‚ºä»€éº¼å®‹æœç„¡æ³•ç¶²æ‹ï¼Ÿ", a: "å› ç‚ºå¤ªå¤šå¥‘ä¸¹äºº", wrong: ["æ²’é›»è…¦", "æ²’æ‰‹æ©Ÿ"] },
            { q: "è‰è·Ÿè›‹èª°æ¯”è¼ƒé«˜ï¼Ÿ", a: "è›‹(è›‹ç³•)", wrong: ["è‰", "ä¸€æ¨£é«˜"] },
            { q: "ä»€éº¼åœ‹å®¶ä¸ç”¨ç™¼é›»ï¼Ÿ", a: "ç·¬ç”¸(å…é›»)", wrong: ["ç‘å…¸", "å†°å³¶"] },
            { q: "ç‚ºä»€éº¼ç‹ç‹¸å¸¸è·Œå€’ï¼Ÿ", a: "å› ç‚ºè…³æ»‘", wrong: ["è…¿çŸ­", "è·‘å¤ªå¿«"] },
            { q: "è¶…äººä¿è­·åœ°çƒï¼Œèª°ä¿è­·åŸå¸‚ï¼Ÿ", a: "è¢å¹•(ä¿è­·ç¨‹å¼)", wrong: ["è™è ä¿ ", "é‹¼éµäºº"] },
            { q: "ç³–æœæ˜¯å…¬çš„é‚„æ˜¯æ¯çš„ï¼Ÿ", a: "æ¯çš„", wrong: ["å…¬çš„", "ä¸­æ€§"] },
            { q: "æ°§æ°£å’ŒäºŒæ°§åŒ–ç¢³èª°æ¯”è¼ƒç¾ï¼Ÿ", a: "æ°§æ°£", wrong: ["äºŒæ°§åŒ–ç¢³", "éƒ½é†œ"] },
            { q: "é¹¿è·Ÿè»Šèª°æœƒè´ï¼Ÿ", a: "é¹¿(éœ²ç‡Ÿè»Š)", wrong: ["è»Š", "å¹³æ‰‹"] },
            { q: "å“ªä½å…¬ä¸»äº¤é€šå·¥å…·ä¸æ€•åˆ®ï¼Ÿ", a: "ç°å§‘å¨˜", wrong: ["ç™½é›ªå…¬ä¸»", "ç¡ç¾äºº"] },
            { q: "çœŸæ­£çš„è±¬å–ä»€éº¼ï¼Ÿ", a: "çç å¥¶èŒ¶", wrong: ["ç™½é–‹æ°´", "é¤¿æ°´"] },
            { q: "ç“¶è“‹æ‰“ä¸é–‹æ‰¾èª°ï¼Ÿ", a: "å­”é›€", wrong: ["å¤§åŠ›å£«", "ç®¡ç†å“¡"] },
            { q: "é´¨å­å“ªè£¡æœ€ç˜¦ï¼Ÿ", a: "å˜´å·´", wrong: ["è…³æŒ", "ç¿…è†€"] },
            { q: "èšŠå­ä¸å®å“ªç¨®å‹•ç‰©ï¼Ÿ", a: "ç‹—(ä¸å®ç‹—)", wrong: ["è²“", "å…”å­"] },
            { q: "å“ªæ¢è¡—ä¸ä¸‹é›¨ï¼Ÿ", a: "èŠéº»è¡—", wrong: ["è¯çˆ¾è¡—", "å•†åº—è¡—"] },
            { q: "ä¸€éš»ç‹¼æ‰åˆ°å†°æ°´ï¼Ÿ", a: "æª³æ¦”", wrong: ["è½æ¹¯ç‹¼", "æ­»ç‹¼"] },
            { q: "å¦‚ä½•ä½¿éº»é›€å®‰éœï¼Ÿ", a: "å£“å®ƒ", wrong: ["é¤µç±³", "é—œç± å­"] },
            { q: "åœ°ç“œç¬‘äº†ï¼Ÿ", a: "åœ°ç“œçƒ", wrong: ["çƒ¤åœ°ç“œ", "åœ°ç“œæ¹¯"] },
            { q: "é›»è…¦çš„åª½åª½ï¼Ÿ", a: "è¢å¹•", wrong: ["ä¸»æ©Ÿæ¿", "éµç›¤"] },
            { q: "ä»€éº¼å³¶æœ€ç†±ï¼Ÿ", a: "é€ä¸­å³¶", wrong: ["ç«ç‡’å³¶", "å¤å¨å¤·"] },
            { q: "ç‚ºä»€éº¼å¤©å†·æ‘¸è‚©è†€ï¼Ÿ", a: "å®ƒæ˜¯Shoulder", wrong: ["å¥½æ‘¸", "ç”Ÿç«"] },
            { q: "æ­»æ‰çš„è…è‡Ÿï¼Ÿ", a: "è¥¿éŠè¨˜", wrong: ["ç´…æ¨“å¤¢", "ä¸‰åœ‹æ¼”ç¾©"] },
            { q: "æœ€å–œæ­¡åé£›æ©Ÿçš„äººæ˜¯èª°ï¼Ÿ", a: "éæ©Ÿå ´äººå“¡", wrong: ["æ©Ÿå¸«", "ç©ºå§"] },
            { q: "å“ªç¨®è”¬èœæœ€å¥½å®¢ï¼Ÿ", a: "å—ç“œ", wrong: ["ç™½èœ", "å—ç“œ"] },
            { q: "ä»€éº¼è»Šå­æœ€è¨å­ï¼Ÿ", a: "å…¬è»Š", wrong: ["è¨ˆç¨‹è»Š", "æ•‘è­·è»Š"] },
            { q: "å“ªä¸€ç§‘æœ€èªçœŸï¼Ÿ", a: "å¤–ç§‘", wrong: ["ç‰™ç§‘", "çœ¼ç§‘"] },
            { q: "ä»€éº¼ç±³ä¸èƒ½åƒï¼Ÿ", a: "è¦ç±³", wrong: ["ç™½ç±³", "ç³¯ç±³"] },
            { q: "ä»€éº¼ç­†ä¸èƒ½å¯«ï¼Ÿ", a: "é›»ç­†", wrong: ["åŸå­ç­†", "é‰›ç­†"] },
            { q: "å“ªç¨®äººä¸èƒ½å»åŠ æ²¹ç«™ï¼Ÿ", a: "æ²¹äºº", wrong: ["è€äºº", "ç—…äºº"] },
            { q: "ç‚ºä»€éº¼ä¼éµåªä½å—æ¥µï¼Ÿ", a: "å› ç‚ºåŒ—æ¥µæœ‰ç†Š", wrong: ["å› ç‚ºæ€•ç†±", "å› ç‚ºè·¯å¤ªé "] },
            { q: "ä»€éº¼ç‹—ä¸å’¬äººï¼Ÿ", a: "ç†±ç‹—", wrong: ["ç©å…·ç‹—", "æ‡¶æƒ°ç‹—"] },
            { q: "å“ªç¨®é›è·‘æœ€å¿«ï¼Ÿ", a: "ç«é›", wrong: ["åœŸé›", "è‚¯å¾·åŸº"] },
            { q: "å“ªç¨®èŠ±æœ€æ‡¶æƒ°ï¼Ÿ", a: "è˜­èŠ±", wrong: ["è“®èŠ±", "ç«ç‘°"] },
            { q: "ä»€éº¼è²“æœ€æ„›é¨™äººï¼Ÿ", a: "åŠ è²è²“", wrong: ["æ³¢æ–¯è²“", "å®å™¹è²“"] },
            { q: "å“ªç¨®æ°´æœæœ€æœƒä¿ä½‘äººï¼Ÿ", a: "è˜‹æœ", wrong: ["è¥¿ç“œ", "é¦™è•‰"] },
            { q: "ä»€éº¼äººä¸€å¹´åªå·¥ä½œä¸€å¤©ï¼Ÿ", a: "è–èª•è€äºº", wrong: ["æ‡¶äºº", "æœ‰éŒ¢äºº"] },
            { q: "å“ªç¨®çƒæœ€ç´¯ï¼Ÿ", a: "è¶³çƒ", wrong: ["ç±ƒçƒ", "ç¶²çƒ"] },
            { q: "ä»€éº¼è·¯ä¸èƒ½èµ°ï¼Ÿ", a: "ç¶²è·¯", wrong: ["æŸæ²¹è·¯", "å¤§é¦¬è·¯"] },
            { q: "å“ªç¨®æ°´æœæœ€æ„›ç”Ÿæ°£ï¼Ÿ", a: "æ¦´æ§¤", wrong: ["æ¢¨å­", "æ©˜å­"] },
            { q: "ä»€éº¼äººæœ€æ„›å¹ç‰›ï¼Ÿ", a: "é¤Šç‰›çš„äºº", wrong: ["é¨™å­", "å•†äºº"] },
            { q: "å“ªç¨®è¡£æœæœ€è²´ï¼Ÿ", a: "çš‡å¸çš„æ–°è¡£", wrong: ["åç‰Œæœé£¾", "å©šç´—"] },
            { q: "ä»€éº¼å±±ä¸èƒ½çˆ¬ï¼Ÿ", a: "å†°å±±", wrong: ["ç‰å±±", "ç«å±±"] },
            { q: "å“ªç¨®æ°´æœ€ç”œï¼Ÿ", a: "ç³–æ°´", wrong: ["å±±æ³‰æ°´", "è‡ªä¾†æ°´"] },
            { q: "ä»€éº¼äººæœ€æ„›å¤§å«ï¼Ÿ", a: "å•å·´", wrong: ["æ­Œæ˜Ÿ", "ç˜‹å­"] },
            { q: "å“ªç¨®ç´™æœ€ä¸èƒ½å¯«å­—ï¼Ÿ", a: "è¡›ç”Ÿç´™", wrong: ["å ±ç´™", "å®£ç´™"] },
            { q: "ä»€éº¼äººæœ€æ„›èµ°è·¯ï¼Ÿ", a: "æ­¥å…µ", wrong: ["æ…¢è·‘è€…", "å°éŠ"] },
            { q: "å“ªç¨®é­šæœ€æ‡¶æƒ°ï¼Ÿ", a: "é¯Šé­š", wrong: ["é‡‘é­š", "é¯‰é­š"] },
            { q: "ä»€éº¼åœ°æ–¹ä¸èƒ½æ‹ç…§ï¼Ÿ", a: "å¤¢è£¡", wrong: ["æ´—æ‰‹é–“", "é›»å½±é™¢"] },
            { q: "å“ªç¨®ç‡ˆæœ€ä¸äº®ï¼Ÿ", a: "ç´…ç¶ ç‡ˆ", wrong: ["æ—¥å…‰ç‡ˆ", "æ‰‹é›»ç­’"] },
            { q: "ä»€éº¼äººæœ€æ„›å¤§ç¬‘ï¼Ÿ", a: "æ„›ç¬‘çš„äºº", wrong: ["å°ä¸‘", "æ¼”å“¡"] },
            { q: "å“ªç¨®èŠ±æœ€æ„›è·³èˆï¼Ÿ", a: "è·³èˆè˜­", wrong: ["èŠèŠ±", "ç‰½ç‰›èŠ±"] },
            { q: "ä»€éº¼æ°´æœæœ€æ„›å”±æ­Œï¼Ÿ", a: "èŠ’æœ", wrong: ["æ°´èœœæ¡ƒ", "è‘¡è„"] },
            { q: "å“ªç¨®äººæœ€æ„›ç¡è¦ºï¼Ÿ", a: "ç¡ç¾äºº", wrong: ["å¬°å…’", "æ‡¶æ¼¢"] },
            { q: "ä»€éº¼åœ°æ–¹æœ€æ„›ä¸‹é›¨ï¼Ÿ", a: "é›¨éƒ½", wrong: ["æ²™æ¼ ", "ç«æ˜Ÿ"] },
            { q: "å“ªç¨®äººæœ€æ„›å–æ°´ï¼Ÿ", a: "å£æ¸´çš„äºº", wrong: ["é­š", "å¤§è±¡"] },
            { q: "ä»€éº¼äººæœ€æ„›åƒè‚‰ï¼Ÿ", a: "é£Ÿè‚‰å‹•ç‰©", wrong: ["å»šå¸«", "çµäºº"] },
            { q: "å“ªç¨®æ°´æœæœ€æ„›èªªè¬Šï¼Ÿ", a: "é¦™è•‰", wrong: ["æœ¨ç“œ", "æ¥Šæ¡ƒ"] },
            { q: "ä»€éº¼äººæœ€æ„›ç™¼å‘†ï¼Ÿ", a: "ç™¼å‘†çš„äºº", wrong: ["å­¸ç”Ÿ", "è€äºº"] },
            { q: "å“ªç¨®èŠ±æœ€æ„›èªªè©±ï¼Ÿ", a: "å–‡å­èŠ±", wrong: ["å‘æ—¥è‘µ", "ç™¾åˆ"] },
            { q: "ä»€éº¼äººæœ€æ„›å¤§å«ï¼Ÿ", a: "åš‡åˆ°çš„äºº", wrong: ["è€å¸«", "éšŠé•·"] },
            { q: "å“ªç¨®ç´™æœ€è²´ï¼Ÿ", a: "éˆ”ç¥¨", wrong: ["ç ‚ç´™", "è¤‡å¯«ç´™"] },
            { q: "ä»€éº¼äººæœ€æ„›èµ°è·¯ï¼Ÿ", a: "è¶•è·¯çš„äºº", wrong: ["éƒµå·®", "å£«å…µ"] },
            { q: "å“ªç¨®æ°´æœæœ€æ„›ç©ï¼Ÿ", a: "è‰è“", wrong: ["è”æ", "é¾çœ¼"] },
            { q: "ä»€éº¼äººæœ€æ„›çœ‹æ›¸ï¼Ÿ", a: "æ›¸èŸ²", wrong: ["åšå£«", "ç®¡ç†å“¡"] },
            { q: "å“ªç¨®èŠ±æœ€æ¼‚äº®ï¼Ÿ", a: "å¿ƒèŠ±", wrong: ["ç‰¡ä¸¹", "é¬±é‡‘é¦™"] },
            { q: "ä»€éº¼äººæœ€æ„›èªªå†·ç¬‘è©±ï¼Ÿ", a: "ä½ ", wrong: ["å†°å¡Š", "ä¼éµ"] }
        ];

        let availableIndices = [];
        let gameQuestions = [];
        let currentIdx = 0;
        let score = 0;
        let isAnswering = false;
        let voices = [];
        let audioCtx = null;

        function initSpeech() {
            const voiceSelect = document.getElementById('voice-select');
            const loadVoices = () => {
                voices = window.speechSynthesis.getVoices();
                voiceSelect.innerHTML = '';
                voices.forEach((v, i) => {
                    if (v.lang.includes('zh') || v.lang.includes('en')) {
                        const opt = document.createElement('option');
                        opt.value = i;
                        opt.textContent = `${v.name} (${v.lang})`;
                        if (v.lang === 'zh-TW') opt.selected = true;
                        voiceSelect.appendChild(opt);
                    }
                });
            };
            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        function createUtterance(text) {
            const u = new SpeechSynthesisUtterance(text);
            const selectedVoiceIndex = document.getElementById('voice-select').value;
            u.voice = voices[selectedVoiceIndex];
            u.pitch = parseFloat(document.getElementById('pitch-range').value);
            u.rate = parseFloat(document.getElementById('rate-range').value);
            u.lang = u.voice ? u.voice.lang : 'zh-TW';
            return u;
        }

        function createSound(type) {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const master = audioCtx.createGain();
            master.connect(audioCtx.destination);

            if (type === 'correct') {
                const osc = audioCtx.createOscillator();
                osc.frequency.setValueAtTime(523, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
                master.gain.setValueAtTime(0.2, audioCtx.currentTime);
                osc.connect(master); osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'wrong') {
                const osc = audioCtx.createOscillator();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(220, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(110, audioCtx.currentTime + 0.2);
                master.gain.setValueAtTime(0.1, audioCtx.currentTime);
                osc.connect(master); osc.start(); osc.stop(audioCtx.currentTime + 0.4);
            } else if (type === 'cheer') {
                for(let i=0; i<15; i++) {
                    const osc = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    osc.frequency.setValueAtTime(400 + Math.random()*600, audioCtx.currentTime + i*0.1);
                    g.gain.setValueAtTime(0, audioCtx.currentTime + i*0.1);
                    g.gain.linearRampToValueAtTime(0.1, audioCtx.currentTime + i*0.1 + 0.05);
                    g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + i*0.1 + 0.3);
                    osc.connect(g); g.connect(master);
                    osc.start(audioCtx.currentTime + i*0.1); osc.stop(audioCtx.currentTime + i*0.1 + 0.3);
                }
            } else if (type === 'clap-heavy') {
                for(let i=0; i<30; i++) {
                    const noise = audioCtx.createBufferSource();
                    const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.1, audioCtx.sampleRate);
                    const data = buffer.getChannelData(0);
                    for(let j=0; j<data.length; j++) data[j] = Math.random()*2 - 1;
                    noise.buffer = buffer;
                    const g = audioCtx.createGain();
                    g.gain.setValueAtTime(0.1, audioCtx.currentTime + Math.random()*1.5);
                    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + Math.random()*1.5 + 0.1);
                    noise.connect(g); g.connect(master);
                    noise.start(audioCtx.currentTime + Math.random()*1.5);
                }
            } else if (type === 'clap-light') {
                for(let i=0; i<10; i++) {
                    const noise = audioCtx.createBufferSource();
                    const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.1, audioCtx.sampleRate);
                    const data = buffer.getChannelData(0);
                    for(let j=0; j<data.length; j++) data[j] = Math.random()*2 - 1;
                    noise.buffer = buffer;
                    const g = audioCtx.createGain();
                    g.gain.setValueAtTime(0.05, audioCtx.currentTime + Math.random()*1);
                    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + Math.random()*1 + 0.05);
                    noise.connect(g); g.connect(master);
                    noise.start(audioCtx.currentTime + Math.random()*1);
                }
            } else if (type === 'tick') {
                const osc = audioCtx.createOscillator();
                osc.frequency.setValueAtTime(1000, audioCtx.currentTime);
                master.gain.setValueAtTime(0.1, audioCtx.currentTime);
                master.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.02);
                osc.connect(master); osc.start(); osc.stop(audioCtx.currentTime + 0.02);
            } else if (type === 'sigh') {
                const noise = audioCtx.createBufferSource();
                const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.5, audioCtx.sampleRate);
                const data = buffer.getChannelData(0);
                for(let j=0; j<data.length; j++) data[j] = Math.random()*2 - 1;
                noise.buffer = buffer;
                const g = audioCtx.createGain();
                g.gain.setValueAtTime(0.1, audioCtx.currentTime);
                g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                noise.connect(g); g.connect(master);
                noise.start();
            } else if (type === 'fail') {
                const osc = audioCtx.createOscillator();
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.5);
                master.gain.setValueAtTime(0.2, audioCtx.currentTime);
                osc.connect(master); osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            }
        }

        function startGame() {
            if (availableIndices.length < 10) availableIndices = Array.from(fullLibrary.keys());
            const indices = shuffle([...availableIndices]).slice(0, 10);
            gameQuestions = indices.map(i => fullLibrary[i]);
            availableIndices = availableIndices.filter(i => !indices.includes(i));
            currentIdx = 0; score = 0;
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            isAnswering = true;
            window.speechSynthesis.cancel();
            const q = gameQuestions[currentIdx];
            document.getElementById('progress-bar').style.width = `${(currentIdx / 10) * 100}%`;
            document.getElementById('question-counter').innerText = `Question ${currentIdx + 1}/10`;
            document.getElementById('score-display').innerText = score;
            document.getElementById('question-text').innerText = q.q;

            const opts = shuffle([{t: q.a, c:true}, {t: q.wrong[0], c:false}, {t: q.wrong[1], c:false}]);
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            opts.forEach((o, i) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full p-4 text-left bg-white border-2 border-slate-200 rounded-2xl text-slate-700 font-bold flex items-center shadow-sm hover:border-blue-300";
                btn.innerHTML = `<span class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center mr-4 text-xs font-black text-slate-400">${i+1}</span>${o.t}`;
                btn.onclick = () => check(btn, o.c);
                container.appendChild(btn);
            });
            setTimeout(playSequence, 500);
        }

        function playSequence() {
            if (!isAnswering) return;
            const q = gameQuestions[currentIdx];
            const queue = [];
            if (document.getElementById('toggle-q').checked) queue.push(`ç¬¬${currentIdx+1}é¡Œã€‚${q.q}`);
            if (document.getElementById('toggle-a').checked) {
                document.querySelectorAll('.option-btn').forEach((b, i) => queue.push(`é¸é …${i+1}ï¼š${b.innerText.replace(/^\d+/, '')}`));
            }
            let i = 0;
            const speakNext = () => {
                if (i >= queue.length || !isAnswering) return;
                const u = createUtterance(queue[i++]);
                u.onend = () => setTimeout(speakNext, 150);
                window.speechSynthesis.speak(u);
            };
            speakNext();
        }

        function replayCurrentSequence() { window.speechSynthesis.cancel(); playSequence(); }

        function check(btn, isCorrect) {
            if (!isAnswering) return;
            isAnswering = false;
            window.speechSynthesis.cancel();
            const mark = isCorrect ? 'correct-mark' : 'wrong-mark';
            document.getElementById(mark).classList.add('show-feedback');
            setTimeout(() => document.getElementById(mark).classList.remove('show-feedback'), 800);
            createSound(isCorrect ? 'correct' : 'wrong');

            if (isCorrect) {
                score += 10;
                btn.classList.replace('bg-white', 'bg-green-500');
                btn.classList.add('text-white', 'border-green-600');
            } else {
                btn.classList.replace('bg-white', 'bg-red-500');
                btn.classList.add('text-white', 'border-red-600');
                document.querySelectorAll('.option-btn').forEach(b => {
                    if (b.innerText.includes(gameQuestions[currentIdx].a)) b.classList.add('border-green-500', 'bg-green-50');
                });
            }
            setTimeout(() => {
                currentIdx++;
                if (currentIdx < 10) loadQuestion(); else end();
            }, 1500);
        }

        function end() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.getElementById('remaining-info').innerText = `é¡Œåº«å‰©é¤˜ ${availableIndices.length} é¡ŒæœªæŒ‘æˆ°`;
            
            let comment = "";
            let emoji = "ğŸ…";
            
            if (score === 100) {
                comment = "å¤§æ»¿è²«ï¼ä½ çœŸæ˜¯çµ•ä¸–è°æ˜ï¼"; emoji = "ğŸ‘‘"; celebrate100();
            } else if (score >= 90) {
                comment = "å¤ªå¼·äº†ï¼å·®é»å°±æ»¿åˆ†ï¼"; emoji = "ğŸ”¥"; createSound('clap-heavy');
            } else if (score >= 80) {
                comment = "ä½ çœŸçš„å¥½æ£’æ£’ï¼"; emoji = "âœ¨"; createSound('clap-light');
            } else if (score >= 70) {
                comment = "å†åŠ æ²¹å§ï¼Œä¸‹æ¬¡æœƒæ›´å¥½ï¼"; emoji = "ğŸ’ª"; createSound('tick');
            } else if (score >= 60) {
                comment = "é‚„å¥½æœ‰åŠæ ¼ï¼Œå¥½éšªï¼"; emoji = "ğŸ˜…"; createSound('sigh');
            } else {
                comment = "åŠ æ²¹åŠ æ²¹ï¼å¤šè½‰ä¸€ä¸‹è…¦è¢‹å§ï¼"; emoji = "ğŸ‘»"; createSound('fail');
            }

            document.getElementById('result-comment').innerText = comment;
            document.getElementById('result-emoji').innerText = emoji;
            
            setTimeout(() => {
                const u = createUtterance(comment);
                window.speechSynthesis.speak(u);
            }, 600);
        }

        function celebrate100() {
            createSound('cheer');
            const count = 200;
            const defaults = { origin: { y: 0.7 } };
            function fire(particleRatio, opts) { confetti({ ...defaults, ...opts, particleCount: Math.floor(count * particleRatio) }); }
            fire(0.25, { spread: 26, startVelocity: 55 });
            fire(0.2, { spread: 60 });
            fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
            fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
            fire(0.1, { spread: 120, startVelocity: 45 });

            const overlay = document.getElementById('firework-canvas');
            overlay.style.display = 'block';
            let flashes = 0;
            const interval = setInterval(() => {
                overlay.style.backgroundColor = `rgba(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255}, 0.2)`;
                setTimeout(() => overlay.style.backgroundColor = 'transparent', 50);
                flashes++;
                if(flashes > 10) { clearInterval(interval); overlay.style.display = 'none'; }
            }, 300);
        }

        function restartGame() { startGame(); }
        function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }
        window.onload = () => { initSpeech(); availableIndices = Array.from(fullLibrary.keys()); document.getElementById('pool-info').innerText = `é¡Œåº«å‰©é¤˜: ${availableIndices.length} é¡Œ`; };
    </script>
</body>
</html>

